#!/usr/bin/env python
import click
import os
from opentutor_classifier.svm import SVMAnswerClassifierTraining
from opentutor_classifier import load_data


@click.group()
def cli():
    pass


@cli.command()
@click.option("-p", "--data", required=False, type=click.Path(exists=True))
@click.option("-s", "--shared", required=False, type=click.Path(exists=True))
@click.option("-o", "--output", required=False, type=click.Path(exists=False))
def train(data: str, shared: str, output: str):
    training = SVMAnswerClassifierTraining(shared_root=shared)
    accuracy = training.train_all(data_root=data, output_dir=output)
    print("Models are saved at: " + output)
    for exp_num, acc in accuracy.items():
        print(f"Accuracy for model={exp_num} is {acc}.")


@cli.command()
@click.option("-p", "--data", required=False, type=click.Path(exists=True))
@click.option("-s", "--shared", required=False, type=click.Path(exists=True))
@click.option("-o", "--output", required=False, type=click.Path(exists=False))
def traindefault(data: str, shared: str, output: str):
    training = SVMAnswerClassifierTraining(shared_root=shared)
    accuracy = training.default_train_all(data_root=data, output_dir=output)
    print("Models are saved at: " + output)
    print(f"Accuracy for model is {accuracy}")


cli.add_command(train)
cli.add_command(traindefault)


if __name__ == "__main__":
    cli()
