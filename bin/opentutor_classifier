#!/usr/bin/env python
import click
import os
from opentutor_classifier.svm import SVMAnswerClassifierTraining
from opentutor_classifier import load_data, load_word2vec_model, load_question


@click.group()
def cli():
    pass


@cli.command()
@click.option("-p", "--data_path", required=False, type=click.Path(exists=True))
@click.option("-s", "--shared_model", required=False, type=click.Path(exists=True))
@click.option("-o", "--output", required=False, type=click.Path(exists=False))
def train(data_path, shared_model, output):
    corpus = load_data(os.path.join(data_path, "lesson1_dataset.csv"))
    question = load_question(os.path.join(data_path, "config.yaml"))
    word2vec_model = load_word2vec_model(shared_model)
    training = SVMAnswerClassifierTraining(word2vec_model)
    accuracy = training.train_all(question, corpus=corpus, output_dir=output)
    print("Models are saved at: " + output)
    for exp_num, acc in accuracy.items():
        print(f"Accuracy for model={exp_num} is {acc}.")



cli.add_command(train)

if __name__ == "__main__":
    cli()
